<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-term Calculator</title>
    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .counter {
            text-align: right;
            padding: 8px;
            margin-top: 15px;
            font-size: 0.8em;
            color: #999;
        }

        .counter span {
            display: inline-block;
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 8px;
            color: #666;
            font-weight: normal;
            margin: 0 2px;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .calculator {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .error {
            color: red;
            margin-top: 10px;
        }

        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>N-term Calculator</h1>
        
        <div class="input-group">
            <label for="maxPoints">Maximaal aantal punten (L):</label>
            <input type="number" id="maxPoints" min="1" step="1" required>
        </div>

        <div class="input-group">
            <label for="nTerm">N-term (tussen -2.0 en 4.0):</label>
            <input type="number" id="nTerm" min="-2.0" max="4.0" step="0.1" required>
        </div>

        <div class="input-group">
            <label for="scoredPoints">Behaalde punten (S):</label>
            <input type="number" id="scoredPoints" min="0" step="1" required>
        </div>

        <button onclick="calculateGrade()">Bereken cijfer</button>

        <div id="result" class="result" style="display: none;">
            <h2>Resultaat</h2>
            <p>Cijfer: <span id="finalGrade"></span></p>
            <p>Toegepaste formule: <span id="usedFormula"></span></p>
        </div>

        <div id="error" class="error" style="display: none;"></div>
    </div>

    <div class="counter">
        Berekeningen: <span id="calculateCounter">0</span>
    </div>

    <div class="explanation">
        <h2>Uitleg berekening</h2>
        <p>De berekening gebruikt de volgende formules:</p>
        <p>Hoofdformule: C = 9·S/L + N</p>
        <p>Grensrelaties:</p>
        <ol>
            <li>C < 1 + 2·S·9/L</li>
            <li>C > 1 + 0,5·S·9/L</li>
            <li>C > 10 - 2·(L-S)·9/L</li>
            <li>C < 10 - 0,5·(L-S)·9/L</li>
        </ol>
    </div>

    <script>
        // Initialize counter from localStorage
        let calculateCount = parseInt(localStorage.getItem('ntermCalculateCount')) || 0;
        document.getElementById('calculateCounter').textContent = calculateCount;

        // Add event listeners for Enter key
        document.getElementById('maxPoints').addEventListener('keydown', handleEnter);
        document.getElementById('nTerm').addEventListener('keydown', handleEnter);
        document.getElementById('scoredPoints').addEventListener('keydown', handleEnter);

        function handleEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission
                calculateGrade();
            }
        }

        function incrementCounter() {
            calculateCount++;
            localStorage.setItem('ntermCalculateCount', calculateCount);
            document.getElementById('calculateCounter').textContent = calculateCount;
        }

        function calculateGrade() {
            // Get input values
            const L = parseFloat(document.getElementById('maxPoints').value);
            const N = parseFloat(document.getElementById('nTerm').value);
            const S = parseFloat(document.getElementById('scoredPoints').value);
            
            // Validate inputs
            if (isNaN(L) || isNaN(N) || isNaN(S)) {
                showError("Vul alle velden in.");
                return;
            }
            
            if (N < -2.0 || N > 4.0) {
                showError("N-term moet tussen -2.0 en 4.0 liggen.");
                return;
            }
            
            if (S > L) {
                showError("Behaalde punten kunnen niet hoger zijn dan het maximum.");
                return;
            }
            
            if (S < 0 || L <= 0) {
                showError("Punten moeten positief zijn.");
                return;
            }

            // Calculate main formula
            let C = (9 * S / L) + N;
            let usedFormula = "Hoofdformule: C = 9·S/L + N";

            // Check boundary relations
            const boundary1 = 1 + 2 * S * 9 / L;
            const boundary2 = 1 + 0.5 * S * 9 / L;
            const boundary3 = 10 - 2 * (L - S) * 9 / L;
            const boundary4 = 10 - 0.5 * (L - S) * 9 / L;

            // Apply boundary relations if necessary
            if (C > boundary1) {
                C = boundary1;
                usedFormula = "Grensrelatie 1: C = 1 + 2·S·9/L";
            }
            if (C < boundary2) {
                C = boundary2;
                usedFormula = "Grensrelatie 2: C = 1 + 0,5·S·9/L";
            }
            if (C < boundary3) {
                C = boundary3;
                usedFormula = "Grensrelatie 3: C = 10 - 2·(L-S)·9/L";
            }
            if (C > boundary4) {
                C = boundary4;
                usedFormula = "Grensrelatie 4: C = 10 - 0,5·(L-S)·9/L";
            }

            // Ensure grade is between 1 and 10
            C = Math.max(1, Math.min(10, C));

            // Round to 1 decimal
            C = Math.round(C * 10) / 10;

            // Display result
            document.getElementById('result').style.display = 'block';
            document.getElementById('finalGrade').textContent = C.toFixed(1);
            document.getElementById('usedFormula').textContent = usedFormula;
            document.getElementById('error').style.display = 'none';
            
            // Increment counter
            incrementCounter();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('result').style.display = 'none';
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-term Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .calculator {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .error {
            color: red;
            margin-top: 10px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
        }

        .formula {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            font-size: 1.1em;
            margin: 10px 0;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .grade-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #007bff;
            text-align: center;
            margin: 10px 0;
        }

        .counter {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
            border-top: 1px dashed #ddd;
        }

        .counter span {
            display: inline-block;
            background-color: #ffebee;
            padding: 3px 8px;
            border-radius: 12px;
            color: #ff4081;
            font-weight: bold;
            margin: 0 4px;
        }

        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>N-term Calculator</h1>
        
        <div class="input-group">
            <label for="maxPoints">Maximaal aantal punten (L):</label>
            <input type="number" id="maxPoints" min="1" step="1" required>
        </div>

        <div class="input-group">
            <label for="nTerm">N-term (tussen -2.0 en 4.0):</label>
            <input type="number" id="nTerm" min="-2.0" max="4.0" step="0.1" required>
        </div>

        <div class="input-group">
            <label for="scoredPoints">Behaalde punten (S):</label>
            <input type="number" id="scoredPoints" min="0" step="1" required>
        </div>

        <button onclick="calculateGrade()">Bereken cijfer</button>

        <div id="result" class="result" style="display: none;">
            <h2>Resultaat</h2>
            <div id="finalGrade" class="grade-display"></div>
            <p>Toegepaste formule:</p>
            <div id="usedFormula" class="formula"></div>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div class="counter">
            Aantal N-termen berekend: <span id="calculateCounter">0</span> 🎉
        </div>

        <div class="explanation">
            <h2>Formules</h2>
            <div class="formula">Hoofdformule: C = 9S/L + N</div>
            <p>Grensrelaties:</p>
            <div class="formula">C &lt; 1 + 2·(9S/L)</div>
            <div class="formula">C &gt; 1 + 0.5·(9S/L)</div>
            <div class="formula">C &gt; 10 - 2·(9(L-S)/L)</div>
            <div class="formula">C &lt; 10 - 0.5·(9(L-S)/L)</div>
        </div>
    </div>

    <script>
        let calculateCount = parseInt(localStorage.getItem('ntermCalculateCount')) || 0;
        document.getElementById('calculateCounter').textContent = calculateCount;

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('result').style.display = 'none';
        }

        function calculateGrade() {
            // Get input values
            const L = parseFloat(document.getElementById('maxPoints').value);
            const N = parseFloat(document.getElementById('nTerm').value);
            const S = parseFloat(document.getElementById('scoredPoints').value);
            
            // Validate inputs
            if (isNaN(L) || isNaN(N) || isNaN(S)) {
                showError("Vul alle velden in.");
                return;
            }
            
            if (N < -2.0 || N > 4.0) {
                showError("N-term moet tussen -2.0 en 4.0 liggen.");
                return;
            }
            
            if (S > L) {
                showError("Behaalde punten kunnen niet hoger zijn dan het maximum.");
                return;
            }
            
            if (S < 0 || L <= 0) {
                showError("Punten moeten positief zijn.");
                return;
            }

            // Calculate main formula
            let C = (9 * S / L) + N;
            let usedFormula = "C = 9S/L + N";

            // Check boundary relations
            const boundary1 = 1 + 2 * S * 9 / L;
            const boundary2 = 1 + 0.5 * S * 9 / L;
            const boundary3 = 10 - 2 * (L - S) * 9 / L;
            const boundary4 = 10 - 0.5 * (L - S) * 9 / L;

            // Apply boundary relations if necessary
            if (C > boundary1) {
                C = boundary1;
                usedFormula = "C = 1 + 2·(9S/L)";
            }
            if (C < boundary2) {
                C = boundary2;
                usedFormula = "C = 1 + 0.5·(9S/L)";
            }
            if (C < boundary3) {
                C = boundary3;
                usedFormula = "C = 10 - 2·(9(L-S)/L)";
            }
            if (C > boundary4) {
                C = boundary4;
                usedFormula = "C = 10 - 0.5·(9(L-S)/L)";
            }

            // Ensure grade is between 1 and 10
            C = Math.max(1, Math.min(10, C));

            // Round to 1 decimal
            C = Math.round(C * 10) / 10;

            // Display result
            document.getElementById('result').style.display = 'block';
            document.getElementById('finalGrade').textContent = C.toFixed(1);
            document.getElementById('usedFormula').textContent = usedFormula;
            document.getElementById('error').style.display = 'none';
            
            // Update counter
            calculateCount++;
            document.getElementById('calculateCounter').textContent = calculateCount;
            localStorage.setItem('ntermCalculateCount', calculateCount);
        }

        // Add event listeners for Enter key
        document.getElementById('maxPoints').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculateGrade();
        });
        document.getElementById('nTerm').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculateGrade();
        });
        document.getElementById('scoredPoints').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculateGrade();
        });
    </script>
</body>
</html>